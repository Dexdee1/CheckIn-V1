<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Strict Version)</title>
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f8fafc; font-size: 14px; color: #334155; }
        .animate-fadeIn { animation: fadeIn 0.2s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .shift-active { border: 2.5px solid #3b82f6 !important; background-color: #eff6ff !important; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .btn-inactive { opacity: 0.3; filter: grayscale(0.8); pointer-events: none; transform: scale(0.95); }
        select, input, textarea, button { font-size: 14px !important; }
        /* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á Scrollbar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="antialiased">
    <div class="max-w-md mx-auto min-h-screen flex flex-col p-5">
        
        <div class="flex flex-col items-center mb-6 px-2 space-y-3">
            <h1 class="text-4xl font-black text-slate-800 uppercase tracking-tighter">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ - ‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</h1>
            <div class="flex gap-2 w-full justify-center">
                <button onclick="showRules()" class="flex-1 max-w-[120px] font-black bg-white text-slate-500 py-2 rounded-full uppercase border border-slate-200 shadow-sm text-[12px] active:scale-95 transition-all">
                    ‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö
                </button>
                <button onclick="location.href='admin.html'" class="flex-1 max-w-[120px] font-black bg-yellow-300 text-black py-2 rounded-full uppercase border border-yellow-400 shadow-sm text-[12px] active:scale-95 transition-all">
                    ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                </button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 mb-6 space-y-5">
            <div>
                <label class="font-black text-slate-400 uppercase tracking-widest ml-2 italic text-[12px]">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                <select id="empList" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none font-bold text-slate-700 mt-1 focus:ring-2 focus:ring-blue-500 shadow-inner">
                    <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ --</option>
                </select>
            </div>
            <div>
                <label class="font-black text-slate-400 uppercase tracking-widest ml-2 italic text-[12px]">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                <select id="locList" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none font-bold text-slate-700 mt-1 focus:ring-2 focus:ring-blue-500 shadow-inner">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà --</option>
                </select>
            </div>
        </div>

        <main class="space-y-8">
            <section class="space-y-4">
                <div class="flex items-center gap-2 px-2">
                    <div class="w-1.5 h-5 bg-orange-500 rounded-full"></div>
                    <h2 class="font-black text-slate-700 italic uppercase text-base">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏∞ 12 ‡∏ä‡∏°.</h2>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="selectShift(this, '‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤')" class="shift-btn bg-yellow-300 p-5 rounded-[1.8rem] shadow-sm border-2 border-transparent text-black font-bold transition-all text-center">
                        <span class="block  text-lg">‚òÄÔ∏è ‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤</span>
                        <span class="text-black  uppercase font-black text-[15px]">08:00 - 20:00</span>
                    </button>
                    <button onclick="selectShift(this, '‡∏Å‡∏∞‡∏î‡∏∂‡∏Å')" class="shift-btn  bg-blue-400 p-5 rounded-[1.8rem] shadow-sm border-2 border-transparent text-blue-800 font-bold transition-all text-center">
                        <span class="block text-lg">üåô ‡∏Å‡∏∞‡∏î‡∏∂‡∏Å</span>
                        <span class="text-blue-800  uppercase font-black text-[15px]">20:00 - 08:00</span>
                    </button>
                </div>
                
                <div class="grid grid-cols-2  gap-4 pt-2">
                    <button id="btnIn" onclick="handleAction('‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô')" class="bg-[#10b981]  text-white py-5 rounded-[2rem] font-black shadow-lg active:scale-95 transition-all   text-lg uppercase">‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</button>
                    <button id="btnOut" onclick="handleAction('‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô')" class="bg-[#f43f5e] text-white py-5 rounded-[2rem] font-black shadow-lg active:scale-95 transition-all  text-lg uppercase">‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</button>
                </div>
            </section>

            <section class="space-y-4">
                <div class="flex items-center gap-2 px-2">
                    <div class="w-1.5 h-5 bg-rose-500 rounded-full"></div>
                    <h2 class="font-black text-slate-700 italic uppercase text-base">‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô & ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h2>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="openLeaveModal('‡∏•‡∏≤‡∏Å‡∏¥‡∏à')" class="bg-white py-4 rounded-2xl shadow-sm text-amber-600 font-black border border-slate-50">üìù ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</button>
                    <button onclick="openLeaveModal('‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢')" class="bg-white py-4 rounded-2xl shadow-sm text-rose-600 font-black border border-slate-50">ü§í ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</button>
                    <button onclick="openLeaveModal('‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏¢‡∏∏‡∏î')" class="bg-white py-4 rounded-2xl shadow-sm text-emerald-600 font-black border border-slate-50">üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏¢‡∏∏‡∏î</button>
                    <button onclick="openLeaveModal('‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤')" class="bg-white py-4 rounded-2xl shadow-sm text-blue-600 font-black border border-slate-50">üèÉ ‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô</button>
                </div>
            </section>

            <section id="recentSection" class="space-y-4 pb-12">
                <div class="flex items-center gap-2 px-2">
                    <div class="w-1.5 h-5 bg-slate-400 rounded-full"></div>
                    <h2 class="font-black text-slate-700 italic uppercase text-base">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>
                </div>
                <div id="activityContainer" class="bg-white rounded-[2rem] overflow-hidden shadow-sm border border-slate-100 p-4">
                    <div class="text-center text-slate-400 font-bold italic">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                </div>
            </section>
        </main>
    </div>

    <div id="customAlert" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-fadeIn">
        <div class="bg-white w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl text-center border border-slate-100">
            <div id="alertIcon" class="text-5xl mb-4">‚ùå</div>
            <h3 class="font-black text-slate-800 uppercase text-lg mb-2 italic">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div id="alertMsg" class="font-bold text-slate-500 mb-8 leading-relaxed"></div>
            <button onclick="closePopup()" class="w-full bg-slate-800 hover:bg-black text-white py-4 rounded-2xl font-black uppercase shadow-lg transition-all active:scale-95 italic text-center">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <div id="leaveModal" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-md animate-fadeIn">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl border border-slate-100">
            <h3 id="leaveTitle" class="font-black text-slate-800 uppercase text-xl mb-4 italic text-center">‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
            <div class="space-y-4">
                <div>
                    <label class="font-black text-slate-400 uppercase text-[10px] ml-2 italic">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)</label>
                    <input type="date" id="leaveDateInput" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none font-bold text-slate-700 mt-1 focus:ring-2 focus:ring-blue-500 shadow-inner">
                    <div id="dateBadgeContainer" class="flex flex-wrap gap-2 mt-3"></div>
                </div>
                <div>
                    <label class="font-black text-slate-400 uppercase text-[10px] ml-2 italic">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="leaveNote" rows="3" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none font-bold text-slate-700 mt-1 focus:ring-2 focus:ring-blue-500 shadow-inner" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..."></textarea>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mt-8">
                <button onclick="closeLeaveModal()" class="bg-slate-200 text-slate-600 py-4 rounded-2xl font-black uppercase shadow-sm active:scale-95 italic">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="submitLeave()" class="bg-blue-600 text-white py-4 rounded-2xl font-black uppercase shadow-lg active:scale-95 italic">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</button>
            </div>
        </div>
    </div>

    <script>
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏¥‡∏á‡∏Å‡πå API ‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const API_URL = "https://script.google.com/macros/s/AKfycbyEqPzr-R_4p8_evzSiaVSisROSm-mPgp0MR8TZpxwCnL5NnjaHCKlcFV0EobPWbdD4/exec";
        
        let selectedShiftName = "";
        let selectedDates = [];
        let currentLeaveType = "";

        window.onload = () => fetchInitialData();

        // --- ‡∏£‡∏∞‡∏ö‡∏ö Popup ---
        function showPopup(msgHTML, isSuccess = false) {
            const modal = document.getElementById('customAlert');
            document.getElementById('alertMsg').innerHTML = msgHTML;
            document.getElementById('alertIcon').innerText = isSuccess ? "‚úÖ" : "‚ùå";
            modal.classList.remove('hidden');
        }

        function closePopup() {
            document.getElementById('customAlert').classList.add('hidden');
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏à‡∏≤‡∏Å Sheet ---
        async function showRules() {
            showPopup("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏é‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...", true);
            try {
                const res = await fetch(`${API_URL}?action=getRules`);
                const rules = await res.json();
                
                if (!rules || rules.length === 0) {
                    showPopup("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô Sheet");
                    return;
                }

                let rulesHTML = `<div class="text-left space-y-3 max-h-[50vh] overflow-y-auto pr-2 custom-scroll">`;
                rules.forEach(item => {
                    rulesHTML += `
                        <div class="bg-slate-50 p-3 rounded-xl border-l-4 border-blue-500 shadow-sm">
                            <p class="font-black text-blue-600 text-[12px] uppercase italic">${item.title}</p>
                            <p class="text-slate-600 text-[11px] font-bold mt-1">${item.detail}</p>
                        </div>`;
                });
                rulesHTML += `</div>`;
                showPopup(rulesHTML, true);
            } catch (err) {
                showPopup("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏é‡πÑ‡∏î‡πâ");
            }
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ---
        async function fetchInitialData() {
            try {
                const res = await fetch(API_URL + "?action=getData");
                const data = await res.json();
                document.getElementById('empList').innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>' + data.employees.map(e => `<option value="${e}">${e}</option>`).join('');
                document.getElementById('locList').innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà --</option>' + data.locations.map(l => `<option value="${l}">${l}</option>`).join('');
                renderActivity(data.recentActivity || []);
            } catch (e) { 
                showPopup("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            }
        }

        function selectShift(btn, name) {
            document.querySelectorAll('.shift-btn').forEach(b => b.classList.remove('shift-active'));
            btn.classList.add('shift-active');
            selectedShiftName = name;
        }

        // --- üõ°Ô∏è Logic ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡πÄ‡∏´‡∏•‡πá‡∏Å ---
        function checkShiftStatus(type) {
            const now = new Date();
            const currentTime = now.getHours() + (now.getMinutes() / 60);
            let start, end;

            if (selectedShiftName === "‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤") {
                if (type === "‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô") { start = 7; end = 9; }
                else { start = 19; end = 21; }
            } else if (selectedShiftName === "‡∏Å‡∏∞‡∏î‡∏∂‡∏Å") {
                if (type === "‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô") { start = 19; end = 21; }
                else { start = 7; end = 9; }
            }

            if (currentTime < start) return "BEFORE";
            if (currentTime > end) return "AFTER";
            return "OK";
        }

        async function handleAction(type) {
            const name = document.getElementById('empList').value;
            const loc = document.getElementById('locList').value;

            if (!name || !loc || !selectedShiftName) {
                showPopup("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö:<br>(‡∏ä‡∏∑‡πà‡∏≠, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏Å‡∏∞‡∏á‡∏≤‡∏ô)");
                return;
            }

            const status = checkShiftStatus(type);
            const styledAction = `<b><u>${type}</u></b>`;

            if (status === "BEFORE") {
                showPopup(`‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ${styledAction} ‡∏Å‡∏£‡∏£‡∏∏‡∏ô‡∏≤‡∏£‡∏≠`);
                return;
            } 
            if (status === "AFTER") {
                showPopup(`‚ùå ‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢! ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ${styledAction} ‡πÅ‡∏•‡πâ‡∏ß`);
                return;
            }

            if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å [${type}] ?`)) {
                sendData(name, loc, type, selectedShiftName, "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥");
            }
        }

        // --- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Sheet ---
        async function sendData(name, loc, type, shift, note) {
            const payload = { name, location: loc, type, shift, note };
            try {
                document.body.style.opacity = "0.5";
                document.body.style.pointerEvents = "none";
                const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(payload) });
                const result = await res.json();
                if(result.status === "success") {
                    showPopup("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", true);
                    setTimeout(() => location.reload(), 2000);
                } else {
                    throw new Error();
                }
            } catch (e) {
                showPopup("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï");
                document.body.style.opacity = "1";
                document.body.style.pointerEvents = "auto";
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏Å‡∏≤‡∏£‡∏•‡∏≤/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°) ---
        function openLeaveModal(type) {
            const name = document.getElementById('empList').value;
            if (!name) return showPopup("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            currentLeaveType = type;
            selectedDates = [];
            document.getElementById('leaveTitle').innerText = `üìù ‡πÅ‡∏à‡πâ‡∏á [${type}]`;
            document.getElementById('dateBadgeContainer').innerHTML = "";
            document.getElementById('leaveNote').value = "";
            document.getElementById('leaveModal').classList.remove('hidden');
        }

        function closeLeaveModal() {
            document.getElementById('leaveModal').classList.add('hidden');
        }

        document.getElementById('leaveDateInput').addEventListener('change', function(e) {
            const date = e.target.value;
            if (date && !selectedDates.includes(date)) {
                selectedDates.push(date);
                renderDateBadges();
            }
            e.target.value = "";
        });

        function renderDateBadges() {
            const container = document.getElementById('dateBadgeContainer');
            container.innerHTML = selectedDates.map((d, index) => `
                <span class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-[11px] font-black flex items-center gap-2 animate-fadeIn border border-blue-200 uppercase">
                    ${d} <button onclick="removeDate(${index})" class="text-blue-400 hover:text-red-500 font-black">‚úï</button>
                </span>`).join('');
        }

        function removeDate(index) {
            selectedDates.splice(index, 1);
            renderDateBadges();
        }

        async function submitLeave() {
            const name = document.getElementById('empList').value;
            const loc = document.getElementById('locList').value || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";
            const note = document.getElementById('leaveNote').value;
            if (selectedDates.length === 0) return showPopup("‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ß‡∏±‡∏ô");
            if (!note.trim()) return showPopup("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤");
            closeLeaveModal();
            sendData(name, loc, currentLeaveType, "‡∏Å‡∏£‡∏ì‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©", `[‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${selectedDates.join(', ')}] ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${note}`);
        }

        function renderActivity(activities) {
            const container = document.getElementById('activityContainer');
            if (activities.length === 0) {
                container.innerHTML = '<div class="text-center text-slate-400 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>';
                return;
            }
            container.innerHTML = activities.slice(0, 5).map(act => `
                <div class="flex items-center justify-between p-3 border-b border-slate-50 last:border-none animate-fadeIn">
                    <div class="flex flex-col">
                        <span class="font-black text-slate-800 uppercase text-xs tracking-tighter">${act.name}</span>
                        <span class="text-[9px] text-slate-400 font-bold uppercase italic">${act.time}</span>
                    </div>
                    <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase ${
                        act.type.includes('‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô') ? 'bg-emerald-100 text-emerald-600 '  : 
                        act.type.includes('‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô') ? 'bg-rose-100 text-rose-600' : 'bg-slate-100 text-slate-600'
                    }">${act.type}</span>
                </div>`).join('');
        }
    </script>
</body>
</html>